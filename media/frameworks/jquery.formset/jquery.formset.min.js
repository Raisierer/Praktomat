!function(e){e.fn.formset=function(a){var s=e.extend({},e.fn.formset.defaults,a),t=s.extraClasses.join(" "),r=e("#id_"+s.prefix+"-TOTAL_FORMS"),i=e("#id_"+s.prefix+"-MAX_NUM_FORMS"),d=e("#id_"+s.prefix+"-MIN_NUM_FORMS"),l="input,select,textarea,label,div",n=e(this),o=function(e,a){s.extraClasses&&(e.removeClass(t),e.addClass(s.extraClasses[a%s.extraClasses.length]))},f=function(e,a,s){var t=new RegExp(a+"-(\\d+|__prefix__)-"),r=a+"-"+s+"-";e.attr("for")&&e.attr("for",e.attr("for").replace(t,r)),e.attr("id")&&e.attr("id",e.attr("id").replace(t,r)),e.attr("name")&&e.attr("name",e.attr("name").replace(t,r))},c=function(){return 0==i.length||""==i.val()||i.val()-r.val()>0},m=function(){return 0==d.length||""==d.val()||r.val()-d.val()>0},h=function(a){var t=e.trim(s.deleteCssClass).replace(/\s+/g,"."),i=e.trim(s.addCssClass).replace(/\s+/g,".");a.is("TR")?a.children(":last").append('<a class="'+s.deleteCssClass+'" href="javascript:void(0)">'+s.deleteText+"</a>"):a.is("UL")||a.is("OL")?a.append('<li><a class="'+s.deleteCssClass+'" href="javascript:void(0)">'+s.deleteText+"</a></li>"):a.append('<a class="'+s.deleteCssClass+'" href="javascript:void(0)">'+s.deleteText+"</a>"),m()||a.find("a."+t).hide(),a.find("a."+t).click(function(){var a,d=e(this).parents("."+s.formCssClass),n=d.find('input:hidden[id $= "-DELETE"]'),h=d.siblings("a."+i+", ."+s.formCssClass+"-add");n.length?(n.val("on"),d.hide(),a=e("."+s.formCssClass).not(":hidden")):(d.remove(),a=e("."+s.formCssClass).not(".formset-custom-template"),r.val(a.length));for(var p=0,C=a.length;p<C;p++)o(a.eq(p),p),n.length||a.eq(p).find(l).each(function(){f(e(this),s.prefix,p)});return m()||e("a."+t).each(function(){e(this).hide()}),h.is(":hidden")&&c()&&h.show(),s.removed&&s.removed(d),!1})};if(n.each(function(a){var t=e(this),r=t.find('input:checkbox[id $= "-DELETE"]');r.length&&(r.is(":checked")?(r.before('<input type="hidden" name="'+r.attr("name")+'" id="'+r.attr("id")+'" value="on" />'),t.hide()):r.before('<input type="hidden" name="'+r.attr("name")+'" id="'+r.attr("id")+'" />'),e('label[for="'+r.attr("id")+'"]').hide(),r.remove()),function(e){return e.find(l).length>0}(t)&&(t.addClass(s.formCssClass),t.is(":visible")&&(h(t),o(t,a)))}),n.length){var p,C,v=!c();if(s.formTemplate?((C=s.formTemplate instanceof e?s.formTemplate:e(s.formTemplate)).removeAttr("id").addClass(s.formCssClass+" formset-custom-template"),C.find(l).each(function(){f(e(this),s.prefix,"__prefix__")}),h(C)):((C=e("."+s.formCssClass+":last").clone(!0).removeAttr("id")).find('input:hidden[id $= "-DELETE"]').remove(),C.find(l).not(s.keepFieldValues).each(function(){var a=e(this);a.is("input:checkbox")||a.is("input:radio")?a.attr("checked",!1):a.val("")})),s.formTemplate=C,n.is("TR")){var u=n.eq(0).children().length,x=e('<tr><td colspan="'+u+'"><a class="'+s.addCssClass+'" href="javascript:void(0)">'+s.addText+"</a></tr>").addClass(s.formCssClass+"-add");n.parent().append(x),v&&x.hide(),p=x.find("a")}else n.filter(":last").after('<a class="'+s.addCssClass+'" href="javascript:void(0)">'+s.addText+"</a>"),p=n.filter(":last").next(),v&&p.hide();p.click(function(){var a=parseInt(r.val()),t=s.formTemplate.clone(!0).removeClass("formset-custom-template"),i=e(e(this).parents("tr."+s.formCssClass+"-add").get(0)||this),d=e.trim(s.deleteCssClass).replace(/\s+/g,".");return o(t,a),t.insertBefore(i).show(),t.find(l).each(function(){f(e(this),s.prefix,a)}),r.val(a+1),m()&&e("a."+d).each(function(){e(this).show()}),c()||i.hide(),s.added&&s.added(t),!1})}return n},e.fn.formset.defaults={prefix:"form",formTemplate:null,addText:"add another",deleteText:"remove",addCssClass:"add-row",deleteCssClass:"delete-row",formCssClass:"dynamic-form",extraClasses:[],keepFieldValues:"",added:null,removed:null}}(jQuery);
